--- a/net/minecraft/server/EntityEnderDragon.java
+++ b/net/minecraft/server/EntityEnderDragon.java
@@ -5,51 +5,57 @@
 import javax.annotation.Nullable;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
+// CraftBukkit start
+import org.bukkit.event.entity.EntityExplodeEvent;
+import org.bukkit.event.entity.EntityRegainHealthEvent;
+// CraftBukkit end
 
+// PAIL: Fixme
 public class EntityEnderDragon extends EntityInsentient implements IComplex, IMonster {
 
-    private static final Logger bJ = LogManager.getLogger();
+    private static final Logger bI = LogManager.getLogger();
     public static final DataWatcherObject<Integer> PHASE = DataWatcher.a(EntityEnderDragon.class, DataWatcherRegistry.b);
     public double[][] b = new double[64][3];
     public int c = -1;
     public EntityComplexPart[] children;
-    public EntityComplexPart bw = new EntityComplexPart(this, "head", 6.0F, 6.0F);
-    public EntityComplexPart bx = new EntityComplexPart(this, "neck", 6.0F, 6.0F);
-    public EntityComplexPart by = new EntityComplexPart(this, "body", 8.0F, 8.0F);
+    public EntityComplexPart bv = new EntityComplexPart(this, "head", 6.0F, 6.0F);
+    public EntityComplexPart bw = new EntityComplexPart(this, "neck", 6.0F, 6.0F);
+    public EntityComplexPart bx = new EntityComplexPart(this, "body", 8.0F, 8.0F);
+    public EntityComplexPart by = new EntityComplexPart(this, "tail", 4.0F, 4.0F);
     public EntityComplexPart bz = new EntityComplexPart(this, "tail", 4.0F, 4.0F);
     public EntityComplexPart bA = new EntityComplexPart(this, "tail", 4.0F, 4.0F);
-    public EntityComplexPart bB = new EntityComplexPart(this, "tail", 4.0F, 4.0F);
+    public EntityComplexPart bB = new EntityComplexPart(this, "wing", 4.0F, 4.0F);
     public EntityComplexPart bC = new EntityComplexPart(this, "wing", 4.0F, 4.0F);
-    public EntityComplexPart bD = new EntityComplexPart(this, "wing", 4.0F, 4.0F);
+    public float bD;
     public float bE;
-    public float bF;
-    public boolean bG;
-    public int bH;
+    public boolean bF;
+    public int bG;
     public EntityEnderCrystal currentEnderCrystal;
-    private final EnderDragonBattle bK;
-    private final DragonControllerManager bL;
-    private int bM = 200;
-    private int bN;
-    private final PathPoint[] bO = new PathPoint[24];
-    private final int[] bP = new int[24];
-    private final Path bQ = new Path();
+    private final EnderDragonBattle bJ;
+    private final DragonControllerManager bK;
+    private int bL = 200;
+    private int bM;
+    private final PathPoint[] bN = new PathPoint[24];
+    private final int[] bO = new int[24];
+    private final Path bP = new Path();
+    private Explosion explosionSource = new Explosion(null, this, Double.NaN, Double.NaN, Double.NaN, Float.NaN, true, true); // CraftBukkit - reusable source for CraftTNTPrimed.getSource()
 
     public EntityEnderDragon(World world) {
         super(world);
-        this.children = new EntityComplexPart[] { this.bw, this.bx, this.by, this.bz, this.bA, this.bB, this.bC, this.bD};
+        this.children = new EntityComplexPart[] { this.bv, this.bw, this.bx, this.by, this.bz, this.bA, this.bB, this.bC};
         this.setHealth(this.getMaxHealth());
         this.setSize(16.0F, 8.0F);
         this.noclip = true;
         this.fireProof = true;
-        this.bM = 100;
+        this.bL = 100;
         this.ah = true;
         if (!world.isClientSide && world.worldProvider instanceof WorldProviderTheEnd) {
-            this.bK = ((WorldProviderTheEnd) world.worldProvider).t();
+            this.bJ = ((WorldProviderTheEnd) world.worldProvider).t();
         } else {
-            this.bK = null;
+            this.bJ = null;
         }
 
-        this.bL = new DragonControllerManager(this);
+        this.bK = new DragonControllerManager(this);
     }
 
     protected void initAttributes() {
@@ -89,20 +95,20 @@
         if (this.world.isClientSide) {
             this.setHealth(this.getHealth());
             if (!this.isSilent()) {
-                f = MathHelper.cos(this.bF * 6.2831855F);
-                f1 = MathHelper.cos(this.bE * 6.2831855F);
+                f = MathHelper.cos(this.bE * 6.2831855F);
+                f1 = MathHelper.cos(this.bD * 6.2831855F);
                 if (f1 <= -0.3F && f >= -0.3F) {
-                    this.world.a(this.locX, this.locY, this.locZ, SoundEffects.aX, this.bI(), 5.0F, 0.8F + this.random.nextFloat() * 0.3F, false);
+                    this.world.a(this.locX, this.locY, this.locZ, SoundEffects.aU, this.bC(), 5.0F, 0.8F + this.random.nextFloat() * 0.3F, false);
                 }
 
-                if (!this.bL.a().a() && --this.bM < 0) {
-                    this.world.a(this.locX, this.locY, this.locZ, SoundEffects.aY, this.bI(), 2.5F, 0.8F + this.random.nextFloat() * 0.3F, false);
-                    this.bM = 200 + this.random.nextInt(200);
+                if (!this.bK.a().a() && --this.bL < 0) {
+                    this.world.a(this.locX, this.locY, this.locZ, SoundEffects.aV, this.bC(), 2.5F, 0.8F + this.random.nextFloat() * 0.3F, false);
+                    this.bL = 200 + this.random.nextInt(200);
                 }
             }
         }
 
-        this.bE = this.bF;
+        this.bD = this.bE;
         float f2;
 
         if (this.getHealth() <= 0.0F) {
@@ -111,20 +117,20 @@
             f2 = (this.random.nextFloat() - 0.5F) * 8.0F;
             this.world.addParticle(EnumParticle.EXPLOSION_LARGE, this.locX + (double) f, this.locY + 2.0D + (double) f1, this.locZ + (double) f2, 0.0D, 0.0D, 0.0D, new int[0]);
         } else {
-            this.de();
+            this.dc();
             f = 0.2F / (MathHelper.sqrt(this.motX * this.motX + this.motZ * this.motZ) * 10.0F + 1.0F);
             f *= (float) Math.pow(2.0D, this.motY);
-            if (this.bL.a().a()) {
-                this.bF += 0.1F;
-            } else if (this.bG) {
-                this.bF += f * 0.5F;
+            if (this.bK.a().a()) {
+                this.bE += 0.1F;
+            } else if (this.bF) {
+                this.bE += f * 0.5F;
             } else {
-                this.bF += f;
+                this.bE += f;
             }
 
             this.yaw = MathHelper.g(this.yaw);
-            if (this.isNoAI()) {
-                this.bF = 0.5F;
+            if (this.hasAI()) {
+                this.bE = 0.5F;
             } else {
                 if (this.c < 0) {
                     for (int i = 0; i < this.b.length; ++i) {
@@ -146,32 +152,32 @@
                 float f4;
 
                 if (this.world.isClientSide) {
-                    if (this.bi > 0) {
-                        double d3 = this.locX + (this.bj - this.locX) / (double) this.bi;
+                    if (this.bh > 0) {
+                        double d3 = this.locX + (this.bi - this.locX) / (double) this.bh;
 
-                        d0 = this.locY + (this.bk - this.locY) / (double) this.bi;
-                        d1 = this.locZ + (this.bl - this.locZ) / (double) this.bi;
-                        d2 = MathHelper.g(this.bm - (double) this.yaw);
-                        this.yaw = (float) ((double) this.yaw + d2 / (double) this.bi);
-                        this.pitch = (float) ((double) this.pitch + (this.bn - (double) this.pitch) / (double) this.bi);
-                        --this.bi;
+                        d0 = this.locY + (this.bj - this.locY) / (double) this.bh;
+                        d1 = this.locZ + (this.bk - this.locZ) / (double) this.bh;
+                        d2 = MathHelper.g(this.bl - (double) this.yaw);
+                        this.yaw = (float) ((double) this.yaw + d2 / (double) this.bh);
+                        this.pitch = (float) ((double) this.pitch + (this.bm - (double) this.pitch) / (double) this.bh);
+                        --this.bh;
                         this.setPosition(d3, d0, d1);
                         this.setYawPitch(this.yaw, this.pitch);
                     }
 
-                    this.bL.a().b();
+                    this.bK.a().b();
                 } else {
-                    IDragonController idragoncontroller = this.bL.a();
+                    IDragonController idragoncontroller = this.bK.a();
 
                     idragoncontroller.c();
-                    if (this.bL.a() != idragoncontroller) {
-                        idragoncontroller = this.bL.a();
+                    if (this.bK.a() != idragoncontroller) {
+                        idragoncontroller = this.bK.a();
                         idragoncontroller.c();
                     }
 
                     Vec3D vec3d = idragoncontroller.g();
 
-                    if (vec3d != null) {
+                    if (vec3d != null && idragoncontroller.getControllerPhase() != DragonControllerPhase.k) { // CraftBukkit - Don't move when hovering // PAIL: rename
                         d0 = vec3d.x - this.locX;
                         d1 = vec3d.y - this.locY;
                         d2 = vec3d.z - this.locZ;
@@ -186,14 +192,14 @@
                         Vec3D vec3d2 = (new Vec3D((double) MathHelper.sin(this.yaw * 0.017453292F), this.motY, (double) (-MathHelper.cos(this.yaw * 0.017453292F)))).a();
 
                         f4 = Math.max(((float) vec3d2.b(vec3d1) + 0.5F) / 1.5F, 0.0F);
-                        this.bh *= 0.8F;
-                        this.bh = (float) ((double) this.bh + d5 * (double) idragoncontroller.h());
-                        this.yaw += this.bh * 0.1F;
+                        this.bg *= 0.8F;
+                        this.bg = (float) ((double) this.bg + d5 * (double) idragoncontroller.h());
+                        this.yaw += this.bg * 0.1F;
                         float f5 = (float) (2.0D / (d4 + 1.0D));
                         float f6 = 0.06F;
 
-                        this.b(0.0F, 0.0F, -1.0F, 0.06F * (f4 * f5 + (1.0F - f5)));
-                        if (this.bG) {
+                        this.a(0.0F, -1.0F, 0.06F * (f4 * f5 + (1.0F - f5)));
+                        if (this.bF) {
                             this.move(EnumMoveType.SELF, this.motX * 0.800000011920929D, this.motY * 0.800000011920929D, this.motZ * 0.800000011920929D);
                         } else {
                             this.move(EnumMoveType.SELF, this.motX, this.motY, this.motZ);
@@ -210,22 +216,22 @@
                 }
 
                 this.aN = this.yaw;
-                this.bw.width = 1.0F;
-                this.bw.length = 1.0F;
-                this.bx.width = 3.0F;
-                this.bx.length = 3.0F;
+                this.bv.width = 1.0F;
+                this.bv.length = 1.0F;
+                this.bw.width = 3.0F;
+                this.bw.length = 3.0F;
+                this.by.width = 2.0F;
+                this.by.length = 2.0F;
                 this.bz.width = 2.0F;
                 this.bz.length = 2.0F;
                 this.bA.width = 2.0F;
                 this.bA.length = 2.0F;
-                this.bB.width = 2.0F;
+                this.bx.length = 3.0F;
+                this.bx.width = 5.0F;
                 this.bB.length = 2.0F;
-                this.by.length = 3.0F;
-                this.by.width = 5.0F;
-                this.bC.length = 2.0F;
+                this.bB.width = 4.0F;
+                this.bC.length = 3.0F;
                 this.bC.width = 4.0F;
-                this.bD.length = 3.0F;
-                this.bD.width = 4.0F;
                 Vec3D[] avec3d = new Vec3D[this.children.length];
 
                 for (int j = 0; j < this.children.length; ++j) {
@@ -239,28 +245,28 @@
                 float f11 = MathHelper.sin(f10);
                 float f12 = MathHelper.cos(f10);
 
-                this.by.B_();
-                this.by.setPositionRotation(this.locX + (double) (f11 * 0.5F), this.locY, this.locZ - (double) (f12 * 0.5F), 0.0F, 0.0F);
-                this.bC.B_();
-                this.bC.setPositionRotation(this.locX + (double) (f12 * 4.5F), this.locY + 2.0D, this.locZ + (double) (f11 * 4.5F), 0.0F, 0.0F);
-                this.bD.B_();
-                this.bD.setPositionRotation(this.locX - (double) (f12 * 4.5F), this.locY + 2.0D, this.locZ - (double) (f11 * 4.5F), 0.0F, 0.0F);
+                this.bx.A_();
+                this.bx.setPositionRotation(this.locX + (double) (f11 * 0.5F), this.locY, this.locZ - (double) (f12 * 0.5F), 0.0F, 0.0F);
+                this.bB.A_();
+                this.bB.setPositionRotation(this.locX + (double) (f12 * 4.5F), this.locY + 2.0D, this.locZ + (double) (f11 * 4.5F), 0.0F, 0.0F);
+                this.bC.A_();
+                this.bC.setPositionRotation(this.locX - (double) (f12 * 4.5F), this.locY + 2.0D, this.locZ - (double) (f11 * 4.5F), 0.0F, 0.0F);
                 if (!this.world.isClientSide && this.hurtTicks == 0) {
+                    this.a(this.world.getEntities(this, this.bB.getBoundingBox().grow(4.0D, 2.0D, 4.0D).d(0.0D, -2.0D, 0.0D)));
                     this.a(this.world.getEntities(this, this.bC.getBoundingBox().grow(4.0D, 2.0D, 4.0D).d(0.0D, -2.0D, 0.0D)));
-                    this.a(this.world.getEntities(this, this.bD.getBoundingBox().grow(4.0D, 2.0D, 4.0D).d(0.0D, -2.0D, 0.0D)));
+                    this.b(this.world.getEntities(this, this.bv.getBoundingBox().g(1.0D)));
                     this.b(this.world.getEntities(this, this.bw.getBoundingBox().g(1.0D)));
-                    this.b(this.world.getEntities(this, this.bx.getBoundingBox().g(1.0D)));
                 }
 
                 double[] adouble = this.a(5, 1.0F);
-                float f13 = MathHelper.sin(this.yaw * 0.017453292F - this.bh * 0.01F);
-                float f14 = MathHelper.cos(this.yaw * 0.017453292F - this.bh * 0.01F);
+                float f13 = MathHelper.sin(this.yaw * 0.017453292F - this.bg * 0.01F);
+                float f14 = MathHelper.cos(this.yaw * 0.017453292F - this.bg * 0.01F);
 
-                this.bw.B_();
-                this.bx.B_();
-                f3 = this.s(1.0F);
-                this.bw.setPositionRotation(this.locX + (double) (f13 * 6.5F * f8), this.locY + (double) f3 + (double) (f9 * 6.5F), this.locZ - (double) (f14 * 6.5F * f8), 0.0F, 0.0F);
-                this.bx.setPositionRotation(this.locX + (double) (f13 * 5.5F * f8), this.locY + (double) f3 + (double) (f9 * 5.5F), this.locZ - (double) (f14 * 5.5F * f8), 0.0F, 0.0F);
+                this.bv.A_();
+                this.bw.A_();
+                f3 = this.q(1.0F);
+                this.bv.setPositionRotation(this.locX + (double) (f13 * 6.5F * f8), this.locY + (double) f3 + (double) (f9 * 6.5F), this.locZ - (double) (f14 * 6.5F * f8), 0.0F, 0.0F);
+                this.bw.setPositionRotation(this.locX + (double) (f13 * 5.5F * f8), this.locY + (double) f3 + (double) (f9 * 5.5F), this.locZ - (double) (f14 * 5.5F * f8), 0.0F, 0.0F);
 
                 int k;
 
@@ -268,15 +274,15 @@
                     EntityComplexPart entitycomplexpart = null;
 
                     if (k == 0) {
-                        entitycomplexpart = this.bz;
+                        entitycomplexpart = this.by;
                     }
 
                     if (k == 1) {
-                        entitycomplexpart = this.bA;
+                        entitycomplexpart = this.bz;
                     }
 
                     if (k == 2) {
-                        entitycomplexpart = this.bB;
+                        entitycomplexpart = this.bA;
                     }
 
                     double[] adouble1 = this.a(12 + k * 2, 1.0F);
@@ -286,14 +292,14 @@
                     float f18 = 1.5F;
 
                     f4 = (float) (k + 1) * 2.0F;
-                    entitycomplexpart.B_();
+                    entitycomplexpart.A_();
                     entitycomplexpart.setPositionRotation(this.locX - (double) ((f11 * 1.5F + f16 * f4) * f8), this.locY + (adouble1[1] - adouble[1]) - (double) ((f4 + 1.5F) * f9) + 1.5D, this.locZ + (double) ((f12 * 1.5F + f17 * f4) * f8), 0.0F, 0.0F);
                 }
 
                 if (!this.world.isClientSide) {
-                    this.bG = this.b(this.bw.getBoundingBox()) | this.b(this.bx.getBoundingBox()) | this.b(this.by.getBoundingBox());
-                    if (this.bK != null) {
-                        this.bK.b(this);
+                    this.bF = this.b(this.bv.getBoundingBox()) | this.b(this.bw.getBoundingBox()) | this.b(this.bx.getBoundingBox());
+                    if (this.bJ != null) {
+                        this.bJ.b(this);
                     }
                 }
 
@@ -307,10 +313,10 @@
         }
     }
 
-    private float s(float f) {
+    private float q(float f) {
         double d0;
 
-        if (this.bL.a().a()) {
+        if (this.bK.a().a()) {
             d0 = -1.0D;
         } else {
             double[] adouble = this.a(5, 1.0F);
@@ -322,12 +328,19 @@
         return (float) d0;
     }
 
-    private void de() {
+    private void dc() {
         if (this.currentEnderCrystal != null) {
             if (this.currentEnderCrystal.dead) {
                 this.currentEnderCrystal = null;
             } else if (this.ticksLived % 10 == 0 && this.getHealth() < this.getMaxHealth()) {
-                this.setHealth(this.getHealth() + 1.0F);
+                // CraftBukkit start
+                EntityRegainHealthEvent event = new EntityRegainHealthEvent(this.getBukkitEntity(), 1.0F, EntityRegainHealthEvent.RegainReason.ENDER_CRYSTAL);
+                this.world.getServer().getPluginManager().callEvent(event);
+
+                if (!event.isCancelled()) {
+                    this.setHealth((float) (this.getHealth() + event.getAmount()));
+                }
+                // CraftBukkit end
             }
         }
 
@@ -353,8 +366,8 @@
     }
 
     private void a(List<Entity> list) {
-        double d0 = (this.by.getBoundingBox().a + this.by.getBoundingBox().d) / 2.0D;
-        double d1 = (this.by.getBoundingBox().c + this.by.getBoundingBox().f) / 2.0D;
+        double d0 = (this.bx.getBoundingBox().a + this.bx.getBoundingBox().d) / 2.0D;
+        double d1 = (this.bx.getBoundingBox().c + this.bx.getBoundingBox().f) / 2.0D;
         Iterator iterator = list.iterator();
 
         while (iterator.hasNext()) {
@@ -366,7 +379,7 @@
                 double d4 = d2 * d2 + d3 * d3;
 
                 entity.f(d2 / d4 * 4.0D, 0.20000000298023224D, d3 / d4 * 4.0D);
-                if (!this.bL.a().a() && ((EntityLiving) entity).bR() < entity.ticksLived - 2) {
+                if (!this.bK.a().a() && ((EntityLiving) entity).bL() < entity.ticksLived - 2) {
                     entity.damageEntity(DamageSource.mobAttack(this), 5.0F);
                     this.a((EntityLiving) this, entity);
                 }
@@ -400,6 +413,10 @@
         int j1 = MathHelper.floor(axisalignedbb.f);
         boolean flag = false;
         boolean flag1 = false;
+        // CraftBukkit start - Create a list to hold all the destroyed blocks
+        List<org.bukkit.block.Block> destroyedBlocks = new java.util.ArrayList<org.bukkit.block.Block>();
+        org.bukkit.craftbukkit.CraftWorld craftWorld = this.world.getWorld();
+        // CraftBukkit end
 
         for (int k1 = i; k1 <= l; ++k1) {
             for (int l1 = j; l1 <= i1; ++l1) {
@@ -413,7 +430,11 @@
                             flag = true;
                         } else if (block != Blocks.BARRIER && block != Blocks.OBSIDIAN && block != Blocks.END_STONE && block != Blocks.BEDROCK && block != Blocks.END_PORTAL && block != Blocks.END_PORTAL_FRAME) {
                             if (block != Blocks.COMMAND_BLOCK && block != Blocks.dc && block != Blocks.dd && block != Blocks.IRON_BARS && block != Blocks.END_GATEWAY) {
-                                flag1 = this.world.setAir(blockposition) || flag1;
+                                // CraftBukkit start - Add blocks to list rather than destroying them
+                                // flag1 = this.world.setAir(blockposition) || flag1;
+                                flag1 = true;
+                                destroyedBlocks.add(craftWorld.getBlockAt(k1, l1, i2));
+                                // CraftBukkit end
                             } else {
                                 flag = true;
                             }
@@ -425,6 +446,41 @@
             }
         }
 
+        // CraftBukkit start - Set off an EntityExplodeEvent for the dragon exploding all these blocks
+        org.bukkit.entity.Entity bukkitEntity = this.getBukkitEntity();
+        EntityExplodeEvent event = new EntityExplodeEvent(bukkitEntity, bukkitEntity.getLocation(), destroyedBlocks, 0F);
+        bukkitEntity.getServer().getPluginManager().callEvent(event);
+        if (event.isCancelled()) {
+            // This flag literally means 'Dragon hit something hard' (Obsidian, White Stone or Bedrock) and will cause the dragon to slow down.
+            // We should consider adding an event extension for it, or perhaps returning true if the event is cancelled.
+            return flag;
+        } else if (event.getYield() == 0F) {
+            // Yield zero ==> no drops
+            for (org.bukkit.block.Block block : event.blockList()) {
+                this.world.setAir(new BlockPosition(block.getX(), block.getY(), block.getZ()));
+            }
+        } else {
+            for (org.bukkit.block.Block block : event.blockList()) {
+                org.bukkit.Material blockId = block.getType();
+                if (blockId == org.bukkit.Material.AIR) {
+                    continue;
+                }
+
+                int blockX = block.getX();
+                int blockY = block.getY();
+                int blockZ = block.getZ();
+
+                Block nmsBlock = org.bukkit.craftbukkit.util.CraftMagicNumbers.getBlock(blockId);
+                if (nmsBlock.a(explosionSource)) {
+                    nmsBlock.dropNaturally(this.world, new BlockPosition(blockX, blockY, blockZ), nmsBlock.fromLegacyData(block.getData()), event.getYield(), 0);
+                }
+                nmsBlock.wasExploded(world, new BlockPosition(blockX, blockY, blockZ), explosionSource);
+
+                this.world.setAir(new BlockPosition(blockX, blockY, blockZ));
+            }
+        }
+        // CraftBukkit end
+
         if (flag1) {
             double d0 = axisalignedbb.a + (axisalignedbb.d - axisalignedbb.a) * (double) this.random.nextFloat();
             double d1 = axisalignedbb.b + (axisalignedbb.e - axisalignedbb.b) * (double) this.random.nextFloat();
@@ -437,8 +493,8 @@
     }
 
     public boolean a(EntityComplexPart entitycomplexpart, DamageSource damagesource, float f) {
-        f = this.bL.a().a(entitycomplexpart, damagesource, f);
-        if (entitycomplexpart != this.bw) {
+        f = this.bK.a().a(entitycomplexpart, damagesource, f);
+        if (entitycomplexpart != this.bv) {
             f = f / 4.0F + Math.min(f, 1.0F);
         }
 
@@ -449,16 +505,16 @@
                 float f1 = this.getHealth();
 
                 this.dealDamage(damagesource, f);
-                if (this.getHealth() <= 0.0F && !this.bL.a().a()) {
+                if (this.getHealth() <= 0.0F && !this.bK.a().a()) {
                     this.setHealth(1.0F);
-                    this.bL.setControllerPhase(DragonControllerPhase.j);
+                    this.bK.setControllerPhase(DragonControllerPhase.j);
                 }
 
-                if (this.bL.a().a()) {
-                    this.bN = (int) ((float) this.bN + (f1 - this.getHealth()));
-                    if ((float) this.bN > 0.25F * this.getMaxHealth()) {
-                        this.bN = 0;
-                        this.bL.setControllerPhase(DragonControllerPhase.e);
+                if (this.bK.a().a()) {
+                    this.bM = (int) ((float) this.bM + (f1 - this.getHealth()));
+                    if ((float) this.bM > 0.25F * this.getMaxHealth()) {
+                        this.bM = 0;
+                        this.bK.setControllerPhase(DragonControllerPhase.e);
                     }
                 }
             }
@@ -469,7 +525,7 @@
 
     public boolean damageEntity(DamageSource damagesource, float f) {
         if (damagesource instanceof EntityDamageSource && ((EntityDamageSource) damagesource).x()) {
-            this.a(this.by, damagesource, f);
+            this.a(this.bx, damagesource, f);
         }
 
         return false;
@@ -479,22 +535,22 @@
         return super.damageEntity(damagesource, f);
     }
 
-    public void killEntity() {
+    public void Q() {
         this.die();
-        if (this.bK != null) {
-            this.bK.b(this);
-            this.bK.a(this);
+        if (this.bJ != null) {
+            this.bJ.b(this);
+            this.bJ.a(this);
         }
 
     }
 
-    protected void bM() {
-        if (this.bK != null) {
-            this.bK.b(this);
+    protected void bG() {
+        if (this.bJ != null) {
+            this.bJ.b(this);
         }
 
-        ++this.bH;
-        if (this.bH >= 180 && this.bH <= 200) {
+        ++this.bG;
+        if (this.bG >= 180 && this.bG <= 200) {
             float f = (this.random.nextFloat() - 0.5F) * 8.0F;
             float f1 = (this.random.nextFloat() - 0.5F) * 4.0F;
             float f2 = (this.random.nextFloat() - 0.5F) * 8.0F;
@@ -505,16 +561,16 @@
         boolean flag = this.world.getGameRules().getBoolean("doMobLoot");
         short short0 = 500;
 
-        if (this.bK != null && !this.bK.d()) {
+        if (this.bJ != null && !this.bJ.d()) {
             short0 = 12000;
         }
 
         if (!this.world.isClientSide) {
-            if (this.bH > 150 && this.bH % 5 == 0 && flag) {
+            if (this.bG > 150 && this.bG % 5 == 0 && flag) {
                 this.a(MathHelper.d((float) short0 * 0.08F));
             }
 
-            if (this.bH == 1) {
+            if (this.bG == 1) {
                 this.world.a(1028, new BlockPosition(this), 0);
             }
         }
@@ -522,13 +578,13 @@
         this.move(EnumMoveType.SELF, 0.0D, 0.10000000149011612D, 0.0D);
         this.yaw += 20.0F;
         this.aN = this.yaw;
-        if (this.bH == 200 && !this.world.isClientSide) {
+        if (this.bG == 200 && !this.world.isClientSide) {
             if (flag) {
                 this.a(MathHelper.d((float) short0 * 0.2F));
             }
 
-            if (this.bK != null) {
-                this.bK.a(this);
+            if (this.bJ != null) {
+                this.bJ.a(this);
             }
 
             this.die();
@@ -546,8 +602,8 @@
 
     }
 
-    public int p() {
-        if (this.bO[0] == null) {
+    public int o() {
+        if (this.bN[0] == null) {
             for (int i = 0; i < 24; ++i) {
                 int j = 5;
                 int k;
@@ -571,35 +627,35 @@
                     }
                 }
 
-                int j1 = Math.max(this.world.getSeaLevel() + 10, this.world.q(new BlockPosition(k, 0, l)).getY() + j);
+                int j1 = Math.max(this.world.K() + 10, this.world.q(new BlockPosition(k, 0, l)).getY() + j);
 
-                this.bO[i] = new PathPoint(k, j1, l);
+                this.bN[i] = new PathPoint(k, j1, l);
             }
 
-            this.bP[0] = 6146;
-            this.bP[1] = 8197;
-            this.bP[2] = 8202;
-            this.bP[3] = 16404;
-            this.bP[4] = '\u8028';
-            this.bP[5] = '\u8050';
-            this.bP[6] = 65696;
-            this.bP[7] = 131392;
-            this.bP[8] = 131712;
-            this.bP[9] = 263424;
-            this.bP[10] = 526848;
-            this.bP[11] = 525313;
-            this.bP[12] = 1581057;
-            this.bP[13] = 3166214;
-            this.bP[14] = 2138120;
-            this.bP[15] = 6373424;
-            this.bP[16] = 4358208;
-            this.bP[17] = 12910976;
-            this.bP[18] = 9044480;
-            this.bP[19] = 9706496;
-            this.bP[20] = 15216640;
-            this.bP[21] = 13688832;
-            this.bP[22] = 11763712;
-            this.bP[23] = 8257536;
+            this.bO[0] = 6146;
+            this.bO[1] = 8197;
+            this.bO[2] = 8202;
+            this.bO[3] = 16404;
+            this.bO[4] = '\u8028';
+            this.bO[5] = '\u8050';
+            this.bO[6] = 65696;
+            this.bO[7] = 131392;
+            this.bO[8] = 131712;
+            this.bO[9] = 263424;
+            this.bO[10] = 526848;
+            this.bO[11] = 525313;
+            this.bO[12] = 1581057;
+            this.bO[13] = 3166214;
+            this.bO[14] = 2138120;
+            this.bO[15] = 6373424;
+            this.bO[16] = 4358208;
+            this.bO[17] = 12910976;
+            this.bO[18] = 9044480;
+            this.bO[19] = 9706496;
+            this.bO[20] = 15216640;
+            this.bO[21] = 13688832;
+            this.bO[22] = 11763712;
+            this.bO[23] = 8257536;
         }
 
         return this.k(this.locX, this.locY, this.locZ);
@@ -611,13 +667,13 @@
         PathPoint pathpoint = new PathPoint(MathHelper.floor(d0), MathHelper.floor(d1), MathHelper.floor(d2));
         byte b0 = 0;
 
-        if (this.bK == null || this.bK.c() == 0) {
+        if (this.bJ == null || this.bJ.c() == 0) {
             b0 = 12;
         }
 
         for (int j = b0; j < 24; ++j) {
-            if (this.bO[j] != null) {
-                float f1 = this.bO[j].b(pathpoint);
+            if (this.bN[j] != null) {
+                float f1 = this.bN[j].b(pathpoint);
 
                 if (f1 < f) {
                     f = f1;
@@ -634,7 +690,7 @@
         PathPoint pathpoint1;
 
         for (int k = 0; k < 24; ++k) {
-            pathpoint1 = this.bO[k];
+            pathpoint1 = this.bN[k];
             pathpoint1.i = false;
             pathpoint1.g = 0.0F;
             pathpoint1.e = 0.0F;
@@ -643,24 +699,24 @@
             pathpoint1.d = -1;
         }
 
-        PathPoint pathpoint2 = this.bO[i];
+        PathPoint pathpoint2 = this.bN[i];
 
-        pathpoint1 = this.bO[j];
+        pathpoint1 = this.bN[j];
         pathpoint2.e = 0.0F;
         pathpoint2.f = pathpoint2.a(pathpoint1);
         pathpoint2.g = pathpoint2.f;
-        this.bQ.a();
-        this.bQ.a(pathpoint2);
+        this.bP.a();
+        this.bP.a(pathpoint2);
         PathPoint pathpoint3 = pathpoint2;
         byte b0 = 0;
 
-        if (this.bK == null || this.bK.c() == 0) {
+        if (this.bJ == null || this.bJ.c() == 0) {
             b0 = 12;
         }
 
         label70:
-        while (!this.bQ.e()) {
-            PathPoint pathpoint4 = this.bQ.c();
+        while (!this.bP.e()) {
+            PathPoint pathpoint4 = this.bP.c();
 
             if (pathpoint4.equals(pathpoint1)) {
                 if (pathpoint != null) {
@@ -681,7 +737,7 @@
 
             while (true) {
                 if (i1 < 24) {
-                    if (this.bO[i1] != pathpoint4) {
+                    if (this.bN[i1] != pathpoint4) {
                         ++i1;
                         continue;
                     }
@@ -696,8 +752,8 @@
                         continue label70;
                     }
 
-                    if ((this.bP[l] & 1 << i1) > 0) {
-                        PathPoint pathpoint5 = this.bO[i1];
+                    if ((this.bO[l] & 1 << i1) > 0) {
+                        PathPoint pathpoint5 = this.bN[i1];
 
                         if (!pathpoint5.i) {
                             float f = pathpoint4.e + pathpoint4.a(pathpoint5);
@@ -707,10 +763,10 @@
                                 pathpoint5.e = f;
                                 pathpoint5.f = pathpoint5.a(pathpoint1);
                                 if (pathpoint5.a()) {
-                                    this.bQ.a(pathpoint5, pathpoint5.e + pathpoint5.f);
+                                    this.bP.a(pathpoint5, pathpoint5.e + pathpoint5.f);
                                 } else {
                                     pathpoint5.g = pathpoint5.e + pathpoint5.f;
-                                    this.bQ.a(pathpoint5);
+                                    this.bP.a(pathpoint5);
                                 }
                             }
                         }
@@ -724,7 +780,7 @@
         if (pathpoint3 == pathpoint2) {
             return null;
         } else {
-            EntityEnderDragon.bJ.debug("Failed to find path from {} to {}", Integer.valueOf(i), Integer.valueOf(j));
+            EntityEnderDragon.bI.debug("Failed to find path from {} to {}", new Object[] { Integer.valueOf(i), Integer.valueOf(j)});
             if (pathpoint != null) {
                 pathpoint.h = pathpoint3;
                 pathpoint3 = pathpoint;
@@ -762,20 +818,20 @@
 
     public void b(NBTTagCompound nbttagcompound) {
         super.b(nbttagcompound);
-        nbttagcompound.setInt("DragonPhase", this.bL.a().getControllerPhase().b());
+        nbttagcompound.setInt("DragonPhase", this.bK.a().getControllerPhase().b());
     }
 
     public void a(NBTTagCompound nbttagcompound) {
         super.a(nbttagcompound);
         if (nbttagcompound.hasKey("DragonPhase")) {
-            this.bL.setControllerPhase(DragonControllerPhase.getById(nbttagcompound.getInt("DragonPhase")));
+            this.bK.setControllerPhase(DragonControllerPhase.getById(nbttagcompound.getInt("DragonPhase")));
         }
 
     }
 
     protected void L() {}
 
-    public Entity[] aZ() {
+    public Entity[] aT() {
         return this.children;
     }
 
@@ -787,29 +843,29 @@
         return this.world;
     }
 
-    public SoundCategory bI() {
+    public SoundCategory bC() {
         return SoundCategory.HOSTILE;
     }
 
-    protected SoundEffect F() {
-        return SoundEffects.aU;
+    protected SoundEffect G() {
+        return SoundEffects.aR;
     }
 
-    protected SoundEffect d(DamageSource damagesource) {
-        return SoundEffects.aZ;
+    protected SoundEffect bW() {
+        return SoundEffects.aW;
     }
 
-    protected float co() {
+    protected float ci() {
         return 5.0F;
     }
 
     @Nullable
     protected MinecraftKey J() {
-        return LootTables.az;
+        return LootTables.ay;
     }
 
     public Vec3D a(float f) {
-        IDragonController idragoncontroller = this.bL.a();
+        IDragonController idragoncontroller = this.bK.a();
         DragonControllerPhase dragoncontrollerphase = idragoncontroller.getControllerPhase();
         Vec3D vec3d;
         float f1;
@@ -820,10 +876,10 @@
 
                 f1 = 1.5F;
                 this.pitch = -45.0F;
-                vec3d = this.g(f);
+                vec3d = this.f(f);
                 this.pitch = f2;
             } else {
-                vec3d = this.g(f);
+                vec3d = this.f(f);
             }
         } else {
             BlockPosition blockposition = this.world.q(WorldGenEndTrophy.a);
@@ -834,7 +890,7 @@
             float f5 = 1.5F;
 
             this.pitch = -f3 * 1.5F * 5.0F;
-            vec3d = this.g(f);
+            vec3d = this.f(f);
             this.pitch = f4;
         }
 
@@ -851,27 +907,27 @@
         }
 
         if (entityendercrystal == this.currentEnderCrystal) {
-            this.a(this.bw, DamageSource.b(entityhuman), 10.0F);
+            this.a(this.bv, DamageSource.b(entityhuman), 10.0F);
         }
 
-        this.bL.a().a(entityendercrystal, blockposition, damagesource, entityhuman);
+        this.bK.a().a(entityendercrystal, blockposition, damagesource, entityhuman);
     }
 
     public void a(DataWatcherObject<?> datawatcherobject) {
         if (EntityEnderDragon.PHASE.equals(datawatcherobject) && this.world.isClientSide) {
-            this.bL.setControllerPhase(DragonControllerPhase.getById(((Integer) this.getDataWatcher().get(EntityEnderDragon.PHASE)).intValue()));
+            this.bK.setControllerPhase(DragonControllerPhase.getById(((Integer) this.getDataWatcher().get(EntityEnderDragon.PHASE)).intValue()));
         }
 
         super.a(datawatcherobject);
     }
 
     public DragonControllerManager getDragonControllerManager() {
-        return this.bL;
+        return this.bK;
     }
 
     @Nullable
-    public EnderDragonBattle dd() {
-        return this.bK;
+    public EnderDragonBattle db() {
+        return this.bJ;
     }
 
     public void addEffect(MobEffect mobeffect) {}
@@ -880,7 +936,7 @@
         return false;
     }
 
-    public boolean bd() {
+    public boolean aX() {
         return false;
     }
 }
